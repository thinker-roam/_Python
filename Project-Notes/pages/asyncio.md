
## what/定义

- 是 Python 标准库中的一个模块
- 提供了编写单线程并发代码的工具
- 使用协程/事件循环和任务来管理并发操作

## what/组成/组合关系

- 协程 （Coroutines）
  - what/定义
    - 一种特殊函数，可以在执行过程中暂停并保存当前状态，
    - 稍后再从暂停位置继续执行
  - what/本质
    - 协程是一种“协作式多任务处理”模型，而不是“抢占式多任务处理”模型
        1. 并发：多个协程可以同时处于活跃状态，看起来像是再 “同时” 执行
        2. 共享线程：所有协程实际上运行在同一个线程中，由事件循环来调度
        3. 主动让步：协程自己决定何时暂停执行，并让出控制权给其他协程
    - 单线程多协程模型

        ```text
        单线程多协程模型：
        ┌───────────────────── 一个操作系统线程 ─────────────────────┐
        │                                                           │
        │  ┌─── 协程A ───┐   ┌─── 协程B ───┐   ┌─── 协程C ───┐      │
        │  │ 开始执行    │   │ 等待中      │   │ 等待中      │      │
        │  │ ...         │   │             │   │             │      │
        │  │ await 暂停点 ├──►│ 开始执行    │   │             │      │
        │  │ 等待中      │   │ ...         │   │             │      │
        │  │             │   │ await 暂停点 ├──►│ 开始执行    │      │
        │  │             │   │ 等待中      │   │ ...         │      │
        │  │ 恢复执行    │◄──┼─────────────┼───┤ await 暂停点 │      │
        │  │ ...         │   │             │   │ 等待中      │      │
        │  └─────────────┘   └─────────────┘   └─────────────┘      │
        │                                                           │
        └───────────────────────────────────────────────────────────┘
        ```

  - what/组成/组合关系
    - 通过 `async def` 定义
    - 使用 `await` 挂起和恢复
    - 可以并发执行，但共享同一个线程
- 事件循环 （Event Loop）
  - 管理协程的执行
  - 调度协程的执行顺序
  - 处理异步I/O操作
  - `asyncio.run()` 是启动事件循环并运行协程的函数
- 任务 （Tasks）
  - 协程的包装
  - 提供任务的取消和状态跟踪
- 回调 （Callbacks）
  - 异步操作完成后执行的回调函数
  - 通常用于处理异步操作的结果

## what/作用

- 简化并发编程
- 提高代码可读性和性能
- 支持异步I/O操作

## what/类比

- 类比JavaScript的 Promise 和 async/await
- 类比Node.js的 EventEmitter

## how/应用场景

- I/O密集型任务
  - 网络请求和API调用
  - 文件读写操作
  - 数据库操作
